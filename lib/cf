#include <bits/stdc++.h>
#include <lib/lca.hpp>

using i64 = long long;

auto solve() {
        int n, q;
        std::cin >> n >> q;

        std::vector<std::vector<int>> g(n);
        for (auto u = 1; u < n; ++u) {
                int t;
                std::cin >> t;

                --t;
                g[u].push_back(t);
                g[t].push_back(u);
        }

        LCA lca(g);
        while (q--) {
                int u, v;
                std::cin >> u >> v;

                --u;
                --v;

                std::cout << lca.lca(u, v) << '\n';
        }
}

auto main() -> int {
        std::ios_base::sync_with_stdio(false);
        std::cin.tie(nullptr);

        solve();
}
